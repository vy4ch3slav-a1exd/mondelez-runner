<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Mondelez Runner ‚Äî Working Build</title>
<meta name="theme-color" content="#0b0b12">
<style>
  html, body { margin:0; height:100%; background:#0b0b12; overflow:hidden; }
  canvas { display:block; width:100vw; height:100vh; touch-action: manipulation; }
  #ui { position:fixed; inset:0; pointer-events:none; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
  .hud { position:absolute; left:12px; top:10px; color:#fff; text-shadow:0 2px 8px rgba(0,0,0,.6); font-weight:700; }
  .hud .line { font-size:14px; opacity:.9; }
  .hud .big { font-size:18px; }
  .btns { position:absolute; right:12px; top:10px; display:flex; gap:8px; }
  .btn { pointer-events:auto; border:none; border-radius:10px; padding:10px 14px; background:#2b225a; color:#fff; font-weight:700; cursor:pointer; box-shadow:0 6px 18px rgba(0,0,0,.25); }
  .btn.sec { background:#2b7bd4; }
  .toast { position:absolute; left:50%; transform:translateX(-50%); bottom:10vh; background:rgba(20,20,35,.9);
           color:#d9d9ff; padding:10px 14px; border:1px solid rgba(122,75,212,.6); border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.4); opacity:0; transition:opacity .25s, transform .25s; pointer-events:none; white-space:nowrap; }
  .toast.show { opacity:1; transform:translate(-50%, -8px); }
  .banner { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none; }
  .card { pointer-events:auto; max-width:min(760px, 94vw); background:rgba(255,255,255,.96); border:3px solid #7a4bd4; border-radius:18px; padding:18px 20px; color:#2b225a; text-align:center; box-shadow:0 18px 60px rgba(0,0,0,.35); }
  .hidden { display:none; }
  .devnames { font-family: ui-monospace, Menlo, Consolas, monospace; color:#00ff95; text-shadow:0 0 8px rgba(0,255,149,.35); font-size:clamp(14px,2.2vw,18px); margin:6px 0 14px; }
  .start-title { font-size: clamp(22px, 4vw, 36px); margin: 8px 0 8px; }
  .mini { opacity:.8; font-size:clamp(12px,2vw,14px); }
  .start-actions { display:flex; justify-content:center; gap:10px; margin-top:12px; }
  .avatar { width:min(160px, 32vw); margin:8px auto 6px; }
  .dbg { position:absolute; left:50%; top:10px; transform:translateX(-50%); background:rgba(0,0,0,.4); color:#0ff; padding:4px 8px; font:12px ui-monospace,monospace; border-radius:8px; pointer-events:none; }
</style>
</head>
<body>
<canvas id="game" aria-label="Mondelez Runner"></canvas>

<!-- START -->
<div class="banner" id="startBanner" aria-modal="true" role="dialog">
  <div class="card">
    <svg class="avatar" viewBox="0 0 200 120" xmlns="http://www.w3.org/2000/svg" aria-label="Hacker FMCG CEOs">
      <defs><linearGradient id="g1" x1="0" x2="0" y1="0" y2="1"><stop offset="0" stop-color="#0f1a2a"/><stop offset="1" stop-color="#1b2a40"/></linearGradient></defs>
      <rect x="0" y="0" width="200" height="120" rx="12" fill="url(#g1)"/>
      <circle cx="70" cy="60" r="28" fill="#111827" stroke="#00ffbf" stroke-width="2"/>
      <rect x="55" y="52" width="30" height="8" rx="3" fill="#00ffbf"/>
      <circle cx="130" cy="60" r="28" fill="#111827" stroke="#7a4bd4" stroke-width="2"/>
      <rect x="115" y="52" width="30" height="8" rx="3" fill="#7a4bd4"/>
      <circle cx="100" cy="25" r="10" fill="#3b2f2f"/><circle cx="100" cy="25" r="6.5" fill="#fff"/>
    </svg>
    <div class="mini">FMCG Hackers</div>
    <h1 class="start-title">Mondelez Runner</h1>
    <div class="devnames">Œõl—î–∫—ÅŒ±ndr R√∏d—ñonœÉv  ‚Ä¢  Œõl—îx—îy Bl—ñnœÉv</div>
    <div class="mini">–î–≤–æ–π–Ω–æ–π –ø—Ä—ã–∂–æ–∫: –≤—Ç–æ—Ä–æ–π —Ç–∞–ø ‚Äî –≤ –≤–æ–∑–¥—É—Ö–µ. –°–æ–±–∏—Ä–∞–π –∫—Ä–æ—à–∫–∏!</div>
    <div class="start-actions"><button class="btn" id="startBtn">START</button></div>
  </div>
</div>

<div id="ui">
  <div class="hud">
    <div class="line big" id="levelLabel">–£—Ä–æ–≤–µ–Ω—å: ‚Äî</div>
    <div class="line" id="scoreLabel">–û—á–∫–∏ (–∫—Ä–æ—à–∫–∏): 0</div>
    <div class="line" id="bestLabel">–†–µ–∫–æ—Ä–¥: 0</div>
    <div class="line" id="statusLabel"></div>
  </div>
  <div class="btns">
    <button class="btn" id="restartBtn">–ó–∞–Ω–æ–≤–æ</button>
    <button class="btn sec" id="pauseBtn">–ü–∞—É–∑–∞</button>
  </div>
  <div class="toast" id="toast">–¢–µ–∫—Å—Ç</div>
  <div class="dbg" id="dbg" style="display:none"></div>

  <div class="banner hidden" id="pauseBanner">
    <div class="card"><h1>–ü–∞—É–∑–∞</h1><p>–¢–∞–ø–Ω–∏ –ø–æ —ç–∫—Ä–∞–Ω—É –∏–ª–∏ –Ω–∞–∂–º–∏ <b>P</b>, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.</p></div>
  </div>

  <div class="banner hidden" id="gameOverBanner">
    <div class="card"><h1>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞</h1><p id="overMsg">–ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑!</p></div>
  </div>

  <div class="banner hidden" id="victoryBanner">
    <div class="card"><h1>–ü–æ–±–µ–¥–∞ üéâ</h1><p>120% KPI!</p></div>
  </div>
</div>

<script>
(function(){
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const dpr = Math.max(1, Math.min(3, window.devicePixelRatio||1));
  const ui = {
    start: document.getElementById('startBanner'),
    startBtn: document.getElementById('startBtn'),
    pause: document.getElementById('pauseBanner'),
    over: document.getElementById('gameOverBanner'),
    victory: document.getElementById('victoryBanner'),
    level: document.getElementById('levelLabel'),
    score: document.getElementById('scoreLabel'),
    best: document.getElementById('bestLabel'),
    status: document.getElementById('statusLabel'),
    toast: document.getElementById('toast'),
    dbg: document.getElementById('dbg'),
    restartBtn: document.getElementById('restartBtn'),
    pauseBtn: document.getElementById('pauseBtn'),
  };

  let W = innerWidth, H = innerHeight;
  function resize(){
    W = innerWidth; H = innerHeight;
    canvas.style.width = W + 'px'; canvas.style.height = H + 'px';
    canvas.width = Math.floor(W * dpr); canvas.height = Math.floor(H * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0); // draw in CSS pixels
  }
  addEventListener('resize', resize, {passive:true}); resize();

  const SKY=['#0f1220','#0f1424','#111527'];
  const THEME=['#d8c6ff','#cfe6ff','#ffe9c6'];
  const SPEED_UP = 1.04;

  let state='start';
  let levelIndex=0;
  const levels=[
    { name:'–°–∫–ª–∞–¥ –†–¶', seconds:20, speedBase:4.6*SPEED_UP, spawn:{cube:0.5, fall:0.3, wall:0.2} },
    { name:'–ú–∞–≥–∞–∑–∏–Ω', seconds:24, speedBase:5.1*SPEED_UP, spawn:{cube:0.48, fall:0.34, wall:0.18} },
    { name:'–ü–µ—Ä–µ–≥–æ–≤–æ—Ä–∫–∞', seconds:28, speedBase:5.5*SPEED_UP, spawn:{cube:0.46, fall:0.34, wall:0.20} }
  ];
  let timeLeft=levels[0].seconds, t=0, last=0, speed=levels[0].speedBase;
  let score=0, best=+localStorage.getItem('mdz_best_crumbs')||0;

  const player={x:0,y:0,r:24,vy:0,onGround:true,shield:0,boost:0,jumps:0};
  const obstacles=[], goodies=[], crumbs=[], particles=[], confetti=[];

  function toast(msg){ ui.toast.textContent=msg; ui.toast.classList.add('show'); clearTimeout(window._toastT); window._toastT=setTimeout(()=>ui.toast.classList.remove('show'), 1600); }
  function rand(a,b){ return a + Math.random()*(b-a); }
  function randI(a,b){ return Math.floor(rand(a,b)); }
  function rect(x,y,w,h,f){ ctx.fillStyle=f; ctx.fillRect(x,y,w,h); }
  function circle(x,y,r,f){ ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fillStyle=f; ctx.fill(); }

  function setupLevel(i){
    const L=levels[i];
    timeLeft=L.seconds;
    obstacles.length=0; goodies.length=0; crumbs.length=0; particles.length=0; confetti.length=0;
    speed=L.speedBase;
    player.x=Math.max(120, W*0.2);
    player.y=H - 0.22*H;
    player.r=Math.max(18, Math.min(30, Math.floor(H*0.035)));
    player.vy=0; player.onGround=true; player.jumps=0; player.shield=0; player.boost=0;
    ui.level.textContent='–£—Ä–æ–≤–µ–Ω—å: '+L.name;
    // spawn something immediately so –ø–æ–ª–µ –Ω–µ –ø—É—Å—Ç–æ–µ
    spawnObstacle(); spawnCrumbs();
  }

  function startGame(){
    ui.start.classList.add('hidden');
    levelIndex=0; score=0; t=0; state='countdown';
    setupLevel(levelIndex);
    countdown(3, ()=>{ state='running'; toast('GO!'); });
  }

  // visible countdown
  function countdown(n, cb){
    const step=()=>{
      drawBG(); drawPlayer();
      ctx.fillStyle='rgba(0,0,0,.4)'; ctx.fillRect(0,0,W, H);
      ctx.fillStyle='#fff'; ctx.font='bold '+Math.floor(Math.min(W,H)*0.18)+'px system-ui, sans-serif';
      ctx.textAlign='center'; ctx.textBaseline='middle';
      ctx.fillText(n.toString(), W/2, H/2);
      if(n>1){ setTimeout(()=>{ n--; step(); }, 600); } else { setTimeout(cb, 600); }
    };
    step();
  }

  function drawBG(){
    const g=ctx.createLinearGradient(0,0,0,H); g.addColorStop(0, SKY[levelIndex]); g.addColorStop(1,'#17182a');
    ctx.fillStyle=g; ctx.fillRect(0,0,W,H);
    ctx.globalAlpha=.24;
    for (let i=0;i<3;i++){
      const base=H*.65 + i*10;
      ctx.beginPath(); ctx.moveTo(0,base);
      for (let x=0;x<=W;x+=12){ const y=base - 24*Math.sin((x*.003)+(i*1.7)+t*.7); ctx.lineTo(x,y); }
      ctx.lineTo(W,H); ctx.lineTo(0,H); ctx.closePath();
      ctx.fillStyle=THEME[i]; ctx.fill();
    }
    ctx.globalAlpha=1;
    rect(0,H*.82,W,H*.18,'#f7f2ff22');
  }

  function drawPlayer(){
    // shadow
    circle(player.x, H*.8, player.r*.9, 'rgba(0,0,0,.15)');
    // Oreo
    circle(player.x-3, player.y+2, player.r, '#3b2f2f');
    circle(player.x, player.y, player.r*.78, '#fff');
    circle(player.x+2, player.y-2, player.r, '#4a3a3a');
    ctx.fillStyle='#2d2222';
    for (let i=0;i<12;i++){ const a=i/12*Math.PI*2; circle(player.x+Math.cos(a)*player.r*.6, player.y+Math.sin(a)*player.r*.6, 2, '#2d2222'); }
  }

  function circleRect(cx,cy,cr, rx,ry,rw,rh){ const nx=Math.max(rx,Math.min(cx,rx+rw)); const ny=Math.max(ry,Math.min(cy,ry+rh)); const dx=cx-nx, dy=cy-ny; return dx*dx + dy*dy < cr*cr; }

  let spawnT=0, crumbT=0;
  function spawnObstacle(){
    const S=levels[levelIndex].spawn; const r=Math.random();
    let type = r<S.cube ? 'cube' : (r<S.cube+S.fall ? 'fall' : 'wall');
    if (type==='cube'){ const s=randI(player.r*1.0, player.r*1.4); obstacles.push({type,x:W+40,y:H*.82-s,w:s,h:s,vy:0}); }
    else if (type==='fall'){ const s=randI(player.r*0.9, player.r*1.3); obstacles.push({type,x:W+randI(0,60),y:-s,w:s,h:s,vy:rand(2.6,3.6)}); }
    else { const w=randI(player.r*1.8, player.r*2.4), h=randI(player.r*0.9, player.r*1.2); obstacles.push({type,x:W+40,y:H*.82-h,w,h,vy:0}); }
  }
  function spawnCrumbs(){
    const num = randI(4,7), baseX = W + 40, baseY = rand(H*.48, H*.75), spacing = Math.max(30, Math.floor(player.r*1.3));
    for (let i=0;i<num;i++){ crumbs.push({x: baseX + i*spacing, y: baseY - Math.sin(i/num*Math.PI)*Math.max(10, player.r*0.8), r: Math.max(6, Math.floor(player.r*0.35)), got:false}); }
  }

  function update(dt){
    if (state!=='running') return;
    t+=dt; timeLeft-=dt;
    if (timeLeft<=0){ levelIndex++; if (levelIndex>=levels.length){ win(); return; } setupLevel(levelIndex); }

    speed = levels[levelIndex].speedBase + Math.min(3, Math.floor(t/12));
    player.vy += H*0.0015; player.y += player.vy;
    const gy=H*.78;
    if (player.y>gy){ player.y=gy; player.vy=0; if (!player.onGround){ player.onGround=true; player.jumps=0; } }

    spawnT-=dt; if (spawnT<=0){ spawnObstacle(); spawnT=0.96*rand(1.0,1.6); }
    crumbT-=dt; if (crumbT<=0){ spawnCrumbs(); crumbT=rand(0.9,1.2); }

    for (const o of obstacles){ o.x -= speed; o.y += o.vy||0; if (o.type==='fall' && o.y>H*.82-o.h){ o.y=H*.82-o.h; o.vy=0; } }
    for (let i=obstacles.length-1;i>=0;i--){ if (obstacles[i].x + obstacles[i].w < -40) obstacles.splice(i,1); }

    for (const c of crumbs){ c.x -= speed*.9; }
    for (let i=crumbs.length-1;i>=0;i--){ if (crumbs[i].x < -40 || crumbs[i].got) crumbs.splice(i,1); }

    for (const o of obstacles){
      if (circleRect(player.x, player.y, player.r*0.85, o.x,o.y,o.w,o.h)){ gameOver(); return; }
    }
    for (const c of crumbs){
      if (!c.got && Math.hypot(player.x-c.x, player.y-c.y) < player.r + c.r){ c.got=true; score += 1; }
    }

    ui.score.textContent='–û—á–∫–∏ (–∫—Ä–æ—à–∫–∏): '+score;
    ui.best.textContent='–†–µ–∫–æ—Ä–¥: '+Math.max(best, score);
    ui.status.textContent=`–û—Å—Ç–∞–ª–æ—Å—å: ${Math.max(0, Math.ceil(timeLeft))}—Å`;
  }

  function render(){
    drawBG();
    // obstacles
    ctx.fillStyle='#ff4b6e';
    for (const o of obstacles){
      if (o.type==='cube'){ rect(o.x,o.y,o.w,o.h,'#ff4b6e'); }
      else if (o.type==='fall'){ rect(o.x,o.y,o.w,o.h,'#e8a36b'); }
      else { rect(o.x,o.y,o.w,o.h,'#ffb84b'); }
    }
    // crumbs
    for (const c of crumbs){ circle(c.x, c.y, Math.max(6, Math.floor(player.r*0.35)), '#6d3b2a'); }
    // player
    drawPlayer();
  }

  function loop(ts){
    const dt = Math.min(0.033, (ts-last)/1000 || 0.016);
    last = ts || (last + 16.6);
    try { update(dt); render(); } catch(e){ ui.dbg.style.display='block'; ui.dbg.textContent = 'JS error: '+ e.message; console.error(e); }
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);

  // controls
  function handleJump(){
    if (state!=='running') return;
    if (player.onGround && player.jumps===0){ player.vy = -Math.max(12, H*0.024); player.onGround=false; player.jumps=1; return; }
    if (!player.onGround && player.jumps===1){ player.vy = -Math.max(12, H*0.024); player.jumps=2; }
  }
  canvas.addEventListener('pointerdown', handleJump, {passive:true});
  addEventListener('keydown', e=>{ if (e.code==='Space' || e.code==='ArrowUp'){ e.preventDefault(); handleJump(); } if (e.code==='KeyP'){ togglePause(); } });

  ui.startBtn.addEventListener('click', startGame, {passive:true});
  ui.pauseBtn.addEventListener('click', togglePause);
  ui.restartBtn.addEventListener('click', ()=>{ ui.over.classList.add('hidden'); ui.victory.classList.add('hidden'); startGame(); });

  function togglePause(){ if (state==='running'){ state='paused'; ui.pause.classList.remove('hidden'); } else if (state==='paused'){ state='running'; ui.pause.classList.add('hidden'); } }

  function gameOver(){ state='over'; best=Math.max(best, score); localStorage.setItem('mdz_best_crumbs', best); document.getElementById('overMsg').textContent=`–ö—Ä–æ—à–µ–∫: ${score} ‚Ä¢ –†–µ–∫–æ—Ä–¥: ${best}`; ui.over.classList.remove('hidden'); }
  function win(){ state='victory'; best=Math.max(best, score); localStorage.setItem('mdz_best_crumbs', best); ui.victory.classList.remove('hidden'); }

})();</script>
</body>
</html>
