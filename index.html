<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover" />
<title>Mondelez Runner ‚Äî 2D ULTRA BRIGHT</title>
<meta name="theme-color" content="#191a3a">
<style>
  :root{
    --bgTop:#1a2248;
    --bgBot:#0f1330;
    --ground:#ece4ff;
    --ink:#1b1240;
    --accent:#7a4bd4;
    --accent2:#2b7bd4;
    --mint:#00d6a0;
    --warn:#ff4b6e;
    --amber:#ffb84b;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:var(--bgBot);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  canvas{display:block;width:100vw;height:100vh;touch-action:manipulation}
  #ui{position:fixed;inset:0;pointer-events:none}
  .hud{position:absolute;left:12px;top:10px;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,.5);font-weight:800}
  .hud .l{font-size:14px;opacity:.95}
  .hud .b{font-size:18px;margin-bottom:2px}
  .btns{position:absolute;right:12px;top:10px;display:flex;gap:8px}
  .btn{pointer-events:auto;border:none;border-radius:10px;padding:10px 14px;background:#2b225a;color:#fff;font-weight:800;box-shadow:0 6px 18px rgba(0,0,0,.25);cursor:pointer}
  .btn.sec{background:var(--accent2)}
  .toast{position:absolute;left:50%;transform:translateX(-50%);bottom:10vh;background:rgba(20,20,35,.9);color:#d9d9ff;padding:10px 14px;border:1px solid rgba(122,75,212,.6);border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.35);opacity:0;transition:opacity .25s,transform .25s;pointer-events:none;white-space:nowrap}
  .toast.show{opacity:1;transform:translate(-50%,-8px)}
  .banner{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
  .card{pointer-events:auto;max-width:min(760px,94vw);background:#fff;border:3px solid var(--accent);border-radius:18px;padding:18px 20px;color:var(--ink);text-align:center;box-shadow:0 18px 60px rgba(0,0,0,.35)}
  .hidden{display:none}
  .dev{font-family:ui-monospace,Menlo,Consolas,monospace;color:var(--mint);text-shadow:0 0 8px rgba(0,255,149,.35);font-size:clamp(13px,2.2vw,18px);margin:6px 0 12px}
  .title{font-size:clamp(22px,4vw,36px);margin:6px 0 8px}
  .mini{opacity:.85;font-size:clamp(12px,2vw,14px)}
  .start-actions{display:flex;justify-content:center;gap:10px;margin-top:12px}
  .count{position:absolute;left:50%;top:38%;transform:translate(-50%,-50%);color:#fff;font-weight:900;font-size:12vh;text-shadow:0 10px 50px rgba(0,0,0,.35);pointer-events:none}
  .hint{position:absolute;left:50%;bottom:22px;transform:translateX(-50%);color:#002b23;background:#bff2e8;border:2px solid #0acaa0;padding:6px 10px;border-radius:10px;font:12px/1.2 ui-monospace,Menlo,Consolas,monospace}
  .badge{position:absolute;right:12px;bottom:12px;color:#9ff;background:rgba(0,0,0,.35);padding:6px 10px;border-radius:10px;font:11px/1.2 ui-monospace,Menlo,Consolas,monospace;opacity:.7}
</style>
</head>
<body>
<canvas id="cv"></canvas>

<div id="ui">
  <div class="hud">
    <div class="b" id="lblLevel">–£—Ä–æ–≤–µ–Ω—å: ‚Äî</div>
    <div class="l" id="lblScore">–û—á–∫–∏ (–∫—Ä–æ—à–∫–∏): 0</div>
    <div class="l" id="lblBest">–†–µ–∫–æ—Ä–¥: 0</div>
    <div class="l" id="lblTime"></div>
  </div>
  <div class="btns">
    <button class="btn" id="btnRestart">–ó–∞–Ω–æ–≤–æ</button>
    <button class="btn sec" id="btnPause">–ü–∞—É–∑–∞</button>
  </div>
  <div class="toast" id="toast">text</div>
  <div class="count hidden" id="count">3</div>
  <div class="hint" id="hint">–¢–∞–ø ‚Äî –ø—Ä—ã–∂–æ–∫, –≤—Ç–æ—Ä–æ–π —Ç–∞–ø ‚Äî –¥–≤–æ–π–Ω–æ–π –ø—Ä—ã–∂–æ–∫</div>
  <div class="badge">2D ‚Ä¢ bright ‚Ä¢ shield glow ‚Ä¢ labels</div>

  <div class="banner" id="startB">
    <div class="card">
      <div style="font-size:42px;margin-bottom:6px;">üç™‚ú®</div>
      <div class="title">Mondelez Runner ‚Äî 2D ULTRA BRIGHT</div>
      <div class="dev">Œõl—î–∫—ÅŒ±ndr R√∏d—ñonœÉv ‚Ä¢ Œõl—îx—îy Bl—ñnœÉv</div>
      <div class="mini">–Ø—Ä—á–µ, –ø–æ–Ω—è—Ç–Ω–µ–µ –∏ –¥–∏–Ω–∞–º–∏—á–Ω–µ–µ: —Ç–µ–Ω–∏, –¥–æ—Ä–æ–∂–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞, –ø–æ–¥–ø–∏—Å–∏ –±–æ–Ω—É—Å–æ–≤, —â–∏—Ç ¬´–ø—Ä–µ–ø–∞–∫¬ª —Å–≤–µ—Ç–∏—Ç—Å—è. –î–≤–æ–π–Ω–æ–π –ø—Ä—ã–∂–æ–∫ —Å <i>coyote</i> –∏ <i>buffer</i>.</div>
      <div class="start-actions"><button class="btn" id="btnStart">START</button></div>
    </div>
  </div>
</div>

<script>
(function(){
  'use strict';
  const cv = document.getElementById('cv');
  const ctx = cv.getContext('2d');
  let DPR=1, W=0, H=0;
  function fit(){
    const w = Math.max(320, innerWidth||document.documentElement.clientWidth);
    const h = Math.max(320, innerHeight||document.documentElement.clientHeight);
    DPR = Math.max(1, Math.min(3, devicePixelRatio||1));
    cv.style.width=w+'px'; cv.style.height=h+'px';
    cv.width = Math.floor(w*DPR); cv.height=Math.floor(h*DPR);
    ctx.setTransform(DPR,0,0,DPR,0,0); W=w; H=h;
  }
  addEventListener('resize', fit); addEventListener('orientationchange', ()=>setTimeout(fit,120)); fit();

  // UI refs
  const ui={
    level:document.getElementById('lblLevel'),
    score:document.getElementById('lblScore'),
    best:document.getElementById('lblBest'),
    time:document.getElementById('lblTime'),
    toast:document.getElementById('toast'),
    startB:document.getElementById('startB'),
    startBtn:document.getElementById('btnStart'),
    pauseBtn:document.getElementById('btnPause'),
    restartBtn:document.getElementById('btnRestart'),
    count:document.getElementById('count'),
    hint:document.getElementById('hint')
  };
  function toast(s){ ui.toast.textContent=s; ui.toast.classList.add('show'); clearTimeout(toast._t); toast._t=setTimeout(()=>ui.toast.classList.remove('show'),2200); }

  // Colors
  const C={
    skyTop:getCSS('--bgTop'), skyBot:getCSS('--bgBot'),
    ground:getCSS('--ground'), ink:getCSS('--ink'),
    warn:getCSS('--warn'), amber:getCSS('--amber'), acc:getCSS('--accent'), acc2:getCSS('--accent2'),
    choco:'#4a3328', chip:'#6d3b2a', white:'#fff', mint:getCSS('--mint')
  };
  function getCSS(n){ return getComputedStyle(document.documentElement).getPropertyValue(n).trim(); }

  // Game state
  let state='start', t=0, last=0, timeLeft=0, levelIdx=0, speed=5.2;
  let score=0, best=+localStorage.getItem('mdz_best_bright')||0;
  const levels=[
    {name:'–°–∫–ª–∞–¥ –†–¶', seconds:26, speed:5.4},
    {name:'–ú–∞–≥–∞–∑–∏–Ω', seconds:30, speed:5.8},
    {name:'–ü–µ—Ä–µ–≥–æ–≤–æ—Ä–∫–∞', seconds:34, speed:6.2}
  ];

  // Entities
  const player={x:0,y:0,r:24,vy:0,onGround:true,jumps:0,shield:0,boost:0};
  const obstacles=[], goodies=[], crumbs=[], particles=[];
  let spawnT=0, goodieT=0, crumbT=0;

  function setupLevel(i){
    const L=levels[i]; timeLeft=L.seconds; speed=L.speed;
    obstacles.length=0; goodies.length=0; crumbs.length=0; particles.length=0;
    player.r=Math.max(18, Math.min(32, Math.floor(H*0.035)));
    player.x=Math.max(120, W*0.22); player.y=H*0.78; player.vy=0; player.onGround=true; player.jumps=0; player.shield=0; player.boost=0;
    ui.level.textContent='–£—Ä–æ–≤–µ–Ω—å: '+L.name; toast('–£—Ä–æ–≤–µ–Ω—å: '+L.name+' ‚Ä¢ –î–≤–æ–π–Ω–æ–π –ø—Ä—ã–∂–æ–∫');
  }
  function reset(){ levelIdx=0; setupLevel(0); score=0; t=0; startCountdown(); }

  // Controls with coyote + buffer
  let coyote=0, buffer=0;
  const COYOTE=0.14, BUFFER=0.16;
  function requestJump(){ buffer=BUFFER; tryJump(); }
  function tryJump(){
    if((player.onGround || coyote>0) && player.jumps===0){
      player.vy = -Math.max(12, H*0.024); player.onGround=false; player.jumps=1; coyote=0; buffer=0; return;
    }
    if(!player.onGround && player.jumps===1){
      player.vy = -Math.max(11, H*0.022); player.jumps=2; buffer=0; return;
    }
  }

  // Input attach after start
  function attachInputs(){
    cv.addEventListener('pointerdown', requestJump, {passive:true});
    addEventListener('keydown', e=>{ if(e.code==='Space'||e.code==='ArrowUp'){ e.preventDefault(); requestJump(); } if(e.code==='KeyP'){ togglePause(); }}, {passive:false});
  }

  // Spawn
  function spawnObstacle(){
    const r=Math.random(); const type= r<.5?'cube': (r<.8?'wall':'fall');
    if(type==='cube'){ const s=randI(player.r*1.0, player.r*1.4); obstacles.push({type,x:W+40,y:H*.82-s,w:s,h:s,label:'OOS',color:C.warn}); }
    else if(type==='wall'){ const w=randI(player.r*1.8, player.r*2.6), h=randI(player.r*0.9, player.r*1.2); obstacles.push({type,x:W+40,y:H*.82-h,w:h*1.1,h, label:'ERP —É–ø–∞–ª', color:C.amber}); }
    else { const s=randI(player.r*0.9, player.r*1.3); obstacles.push({type,x:W+randI(0,60),y:-s,w:s,h:s,vy:rand(2.5,3.6),label:'–ù–µ—Ç —Å—Ç–æ–∫–∞',color:'#e8a36b'}); }
  }
  function spawnGoodie(){
    const r=Math.random(); const type = r<.5?'discount':(r<.8?'prepack':'erid');
    const y=rand(H*.46,H*.7); goodies.push({type,x:W+40,y,r:Math.max(12,Math.floor(player.r*.7)),got:false});
  }
  function spawnCrumbs(){
    const n=randI(4,7), baseX=W+40, baseY=rand(H*.5,H*.75), d=Math.max(30,Math.floor(player.r*1.3));
    for(let i=0;i<n;i++) crumbs.push({x:baseX+i*d, y:baseY - Math.sin(i/n*Math.PI)*Math.max(10, player.r*0.8), r:Math.max(6, Math.floor(player.r*0.35)), got:false});
  }

  // Helpers
  function rand(a,b){ return a + Math.random()*(b-a) } function randI(a,b){ return Math.floor(rand(a,b)) }
  function rect(x,y,w,h,c){ ctx.fillStyle=c; ctx.fillRect(x,y,w,h) }
  function circle(x,y,r,c){ ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fillStyle=c; ctx.fill() }

  // Visuals
  function drawBG(){
    const g=ctx.createLinearGradient(0,0,0,H); g.addColorStop(0,C.skyTop); g.addColorStop(1,C.skyBot);
    ctx.fillStyle=g; ctx.fillRect(0,0,W,H);
    // parallax hills
    ctx.globalAlpha=.25;
    for(let i=0;i<3;i++){ const base=H*.62+i*12; ctx.beginPath(); ctx.moveTo(0,base);
      for(let x=0;x<=W;x+=12){ const y=base - 22*Math.sin((x*.003)+(i*1.6)+t*.7); ctx.lineTo(x,y); }
      ctx.lineTo(W,H); ctx.lineTo(0,H); ctx.closePath(); ctx.fillStyle=i===0?'#dfe9ff':'#f4e9ff'; ctx.fill(); }
    ctx.globalAlpha=1;
    // ground + track lines
    rect(0,H*.82,W,H*.18,C.ground);
    ctx.globalAlpha=.2;
    for(let x=0;x<W;x+=40){ rect(x, H*.82-6, 24, 3, '#000') } // distant strips
    ctx.globalAlpha=1;
  }

  function drawPlayer(){
    // shadow & ground contact
    circle(player.x, H*.8, player.r*.9, 'rgba(0,0,0,.18)');
    // oreo layers
    circle(player.x-3, player.y+2, player.r, C.choco);
    circle(player.x, player.y, player.r*.78, C.white);
    circle(player.x+2, player.y-2, player.r, '#3b2f2f');
    // emboss dots
    ctx.fillStyle='#2d2222';
    for(let i=0;i<12;i++){ const a=i/12*Math.PI*2; circle(player.x+Math.cos(a)*player.r*.6, player.y+Math.sin(a)*player.r*.6, 2, '#2d2222'); }
    // eyes
    const blink=(Math.sin(t*8)>-0.1);
    if (blink){ circle(player.x-6, player.y-4, 3, '#111'); circle(player.x+6, player.y-4, 3, '#111'); }
    else { rect(player.x-9,player.y-5,6,2,'#111'); rect(player.x+3,player.y-5,6,2,'#111'); }
    ctx.strokeStyle='#111'; ctx.lineWidth=2; ctx.beginPath(); ctx.arc(player.x, player.y+6, 7, .15*Math.PI, .85*Math.PI); ctx.stroke();
    // shield glow
    if(player.shield>0){
      const rad = player.r+6; const g=ctx.createRadialGradient(player.x,player.y,player.r, player.x,player.y,rad);
      g.addColorStop(0,'rgba(0,214,255,.25)'); g.addColorStop(1,'rgba(0,214,255,0)');
      circle(player.x, player.y, rad, g);
      ctx.strokeStyle='#00d6ff'; ctx.lineWidth=3; ctx.beginPath(); ctx.arc(player.x,player.y,player.r+4,0,Math.PI*2); ctx.stroke();
    }
  }

  function label(x,y,text,color){
    ctx.font = `bold ${Math.max(11, Math.floor(player.r*.6))}px ui-sans-serif, system-ui`;
    ctx.fillStyle=color||C.ink; ctx.textAlign='center';
    // bubble
    const pad=6, w=ctx.measureText(text).width+pad*2, h=Math.max(18, Math.floor(player.r*.9));
    const rx=x-w/2, ry=y-h-8;
    ctx.fillStyle='rgba(255,255,255,.95)'; roundRect(rx, ry, w, h, 10); ctx.fill();
    ctx.strokeStyle=color||C.acc; ctx.lineWidth=2; roundRect(rx, ry, w, h, 10); ctx.stroke();
    ctx.fillStyle=color||C.acc; ctx.fillText(text, x, ry+h*0.68);
  }
  function roundRect(x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); }

  // Loop
  function loop(ts){ const dt=Math.min(.05,(ts-last)/1000||0); last=ts; if(state==='run') update(dt); render(); requestAnimationFrame(loop) } requestAnimationFrame(loop);

  function update(dt){
    t+=dt; timeLeft-=dt; if(timeLeft<=0){ levelIdx++; if(levelIdx>=levels.length){ win(); return; } setupLevel(levelIdx); }
    let v = speed + Math.min(3, Math.floor(t/12));
    if(player.boost>0){ v+=1.5; player.boost-=dt; }

    // physics
    player.vy += H*0.00155; player.y += player.vy;
    const gy=H*.78;
    if(player.y>gy){ player.y=gy; player.vy=0; if(!player.onGround){ player.onGround=true; player.jumps=0; } }
    else { if(player.onGround){ player.onGround=false; coyote=COYOTE; } }
    if(coyote>0) coyote-=dt;
    if(buffer>0){ buffer-=dt; if(player.onGround) tryJump(); }

    // spawns
    spawnT-=dt; if(spawnT<=0){ spawnObstacle(); spawnT=rand(0.8,1.4); }
    goodieT-=dt; if(goodieT<=0){ spawnGoodie(); goodieT=rand(1.0,1.6); }
    crumbT-=dt; if(crumbT<=0){ spawnCrumbs(); crumbT=rand(0.85,1.35); }

    // move
    for(const o of obstacles){ o.x-=v; o.y += o.vy||0; if(o.type==='fall' && o.y>H*.82-o.h){ o.y=H*.82-o.h; o.vy=0; } }
    for(let i=obstacles.length-1;i>=0;i--) if(obstacles[i].x+obstacles[i].w<-40) obstacles.splice(i,1);

    for(const g of goodies){ g.x-=v*.84 }
    for(let i=goodies.length-1;i>=0;i--) if(goodies[i].x<-40||goodies[i].got) goodies.splice(i,1);

    for(const c of crumbs){ c.x-=v*.9 }
    for(let i=crumbs.length-1;i>=0;i--) if(crumbs[i].x<-40||crumbs[i].got) crumbs.splice(i,1);

    // collisions
    for(const o of obstacles){
      if(circleRect(player.x,player.y,player.r*0.85,o.x,o.y,o.w,o.h)){
        if(player.shield>0){ player.shield=0; spark(o.x+o.w/2,o.y+o.h/2,'#00d6ff'); o.x=-999; }
        else { gameOver(); return; }
      }
    }
    for(const g of goodies){
      if(!g.got && Math.hypot(player.x-g.x, player.y-g.y) < player.r + g.r){
        g.got=true; if(g.type==='discount'){ player.boost=3.0; toast('–î–æ–ø—Å–∫–∏–¥–∫–∞ +3% üöÄ'); }
        else if(g.type==='prepack'){ player.shield=7.0; toast('–ü—Ä–µ–ø–∞–∫ ‚Äî —â–∏—Ç –∞–∫—Ç–∏–≤–µ–Ω'); }
        else { toast('–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ –±–µ–∑ ERID ‚ú®'); }
      }
    }
    for(const c of crumbs){
      if(!c.got && Math.hypot(player.x-c.x, player.y-c.y) < player.r + c.r){
        c.got=true; score+=1; spark(c.x,c.y,C.chip);
      }
    }

    ui.score.textContent='–û—á–∫–∏ (–∫—Ä–æ—à–∫–∏): '+score;
    ui.best.textContent='–†–µ–∫–æ—Ä–¥: '+Math.max(best,score);
    ui.time.textContent=`–û—Å—Ç–∞–ª–æ—Å—å: ${Math.max(0,Math.ceil(timeLeft))}—Å`;
  }

  function render(){
    drawBG();
    // draw obstacles & goodies with labels and shadows
    for(const o of obstacles){
      // shadow
      rect(o.x+2, o.y+o.h+4, o.w, 6, 'rgba(0,0,0,.12)');
      rect(o.x,o.y,o.w,o.h, o.color||C.warn);
      label(o.x+o.w/2, o.y, o.label, '#2b225a');
    }
    for(const g of goodies){
      rect(g.x-18, g.y-14, 36, 28, g.type==='discount'?C.acc2:(g.type==='prepack'?'#00d6ff':C.acc));
      if(g.type==='discount'){ drawText(g.x, g.y+5, '+3%','#fff'); label(g.x,g.y-16,'–î–æ–ø—Å–∫–∏–¥–∫–∞',C.acc2); }
      if(g.type==='prepack'){ circle(g.x,g.y, g.r+2, '#00d6ff'); circle(g.x, g.y, g.r-4, '#bff2ff'); label(g.x,g.y-16,'–ü—Ä–µ–ø–∞–∫ (—â–∏—Ç)','#00d6ff'); }
      if(g.type==='erid'){ star(g.x,g.y, g.r+4, g.r-2, 6, C.acc); label(g.x,g.y-16,'–ë–µ–∑ ERID',C.acc); }
    }
    for(const c of crumbs){ circle(c.x,c.y, Math.max(6, Math.floor(player.r*0.35)), C.chip); }

    for(let i=particles.length-1;i>=0;i--){ const p=particles[i]; ctx.globalAlpha=Math.max(0,p.l); rect(p.x,p.y,3,3,p.c||'#00d6ff'); ctx.globalAlpha=1; p.x+=p.vx; p.y+=p.vy; p.vy+=0.06; p.l-=0.02; if(p.l<=0) particles.splice(i,1); }

    drawPlayer();
  }

  function drawText(x,y,txt,color){ ctx.fillStyle=color||C.ink; ctx.font=`bold ${Math.max(11, Math.floor(player.r*.6))}px ui-sans-serif, system-ui`; ctx.fillText(txt, x-12, y) }
  function star(x,y,outer,inner,points,color){ ctx.fillStyle=color||C.acc; ctx.beginPath(); for(let i=0;i<points*2;i++){ const a=Math.PI*i/points; const r=(i%2===0?outer:inner); ctx.lineTo(x+Math.cos(a)*r, y+Math.sin(a)*r); } ctx.closePath(); ctx.fill(); }
  function spark(x,y,color){ for(let i=0;i<10;i++) particles.push({x,y,vx:rand(-2,2),vy:rand(-3,-.5),l:rand(.4,.9),c:color}) }
  function circleRect(cx,cy,cr,rx,ry,rw,rh){ const nx=Math.max(rx,Math.min(cx,rx+rw)), ny=Math.max(ry,Math.min(cy,ry+rh)); const dx=cx-nx, dy=cy-ny; return dx*dx+dy*dy<cr*cr; }

  // Start/pause
  function startCountdown(){
    let n=3; ui.count.textContent=n; ui.count.classList.remove('hidden');
    const tick=()=>{ n--; if(n>0){ ui.count.textContent=n; setTimeout(tick,600);} else { ui.count.classList.add('hidden'); state='run'; } };
    setTimeout(tick,600);
  }
  function togglePause(){ state = (state==='run'?'pause':'run'); }

  ui.startBtn.addEventListener('click', ()=>{ if(state==='start'){ ui.startB.classList.add('hidden'); reset(); attachInputs(); }}, {passive:true});
  ui.pauseBtn.addEventListener('click', togglePause);
  ui.restartBtn.addEventListener('click', ()=>{ reset(); });

  // initial
  ui.level.textContent='–£—Ä–æ–≤–µ–Ω—å: ‚Äî'; ui.best.textContent='–†–µ–∫–æ—Ä–¥: '+best; ui.score.textContent='–û—á–∫–∏ (–∫—Ä–æ—à–∫–∏): 0';

  // error banner for prod
  addEventListener('error', e=>{ ui.toast.textContent = e.message||'Script error'; ui.toast.classList.add('show'); });
})();
</script>
</body>
</html>
